---
title: "RACE COUNTS: Indicator Methodology"
subtitle: "County and State Data"
date: "October 2024"
output: 
  word_document:
    toc: true
    toc_depth: 3

---
 
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE, dpi = 300, tidy.opts = list(width.cutoff = I(60), tidy = TRUE))

## install and load packages ------------------------------
packages <- c("formattable", "data.table", "ggplot2", "flextable", "officer", "RColorBrewer", "knitr", "ggthemes", "stringr", "cowplot", "extrafont", "grid", "tidyr",   "dplyr", "tidyverse", "RPostgreSQL", "glue", "formatR", "usethis", "here")
install_packages <- packages[!(packages %in% installed.packages()[,"Package"])] 

if(length(install_packages) > 0) { 
  install.packages(install_packages) 
  
} else { 
  
  print("All required packages are already installed.") 
} 

for(pkg in packages){ 
  library(pkg, character.only = TRUE) 
} 

# create connection for rda database
source("W:\\RDA Team\\R\\credentials_source.R")
con <- connect_to_db("racecounts")


```


```{r}
#### UPDATE EACH YEAR
curr_schema <- 'v6'
curr_yr <- '2024'
```


```{r}
##### IMPORT METHODOLOGY DATA FROM POSTGRESQL DATABASE
geo <- 'cntyst'  # once we convert this to an fx, this will be a input into the fx so it works for cntyst/city/leg dist
methodology <- dbGetQuery(con, paste0("SELECT * FROM ", curr_schema, ".arei_indicator_list_", geo))

justice <- methodology %>% filter(grepl("Justice",arei_issue_area))
democracy <- methodology %>% filter(grepl("Democracy",arei_issue_area))
# economic <- methodology %>% filter(grepl("Economic",arei_issue_area))
# education <- methodology %>% filter(grepl("Education",arei_issue_area))
# health <- methodology %>% filter(grepl("Care",arei_issue_area))
# environment <- methodology %>% filter(grepl("Environment",arei_issue_area))
# housing <- methodology %>% filter(grepl("Housing",arei_issue_area))

#text <- paste0(first(justice$arei_issue_area), " has ", nrow(justice), " indicators.")
```

## `r first(justice$arei_issue_area)`

```{r}
for(i in 1:nrow(justice)) { 
  cat("##", justice$arei_indicator[i], "\n")
  cat("Indicator: ", justice$bar_chart_header[i], "\n")
  cat(justice$methodology[i], "\n")
  cat("Source: ", justice$data_source[i], "\n")
  cat("Link: ", "[link placeholder]", "\n")
  cat("Racial/Ethnic Categories: ", "[race/eth placeholder]", "\n")
  cat("\n")
}

```

\pagebreak

## `r first(democracy$arei_issue_area)`

```{r}
for(i in 1:nrow(democracy)) { 
  cat("##", democracy$arei_indicator[i], "\n")
  cat("Indicator: ", democracy$bar_chart_header[i], "\n")
  cat(democracy$methodology[i], "\n")
  cat("Source: ", democracy$data_source[i], "\n")
  cat("Link: ", "[link placeholder]", "\n")
  cat("Racial/Ethnic Categories: ", "[race/eth placeholder]", "\n")
  cat("\n")
}

```


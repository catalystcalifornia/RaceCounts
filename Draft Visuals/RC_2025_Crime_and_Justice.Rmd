---
title: "RACE COUNTS: Crime and Justice"
author: "Authored by: Catalyst California"
date: "8/25/2025"
output:
  html_document: 
    number_sections: no
    theme: flatly
    toc: yes
    toc_depth: 3
    toc_float: yes

subtitle: 'Draft Visuals'
---
  
<style type="text/css">
  h1{
  font-family: Rubik;
  }
  h2{
  font-family: Rubik;
  }
  h3{
  font-family: Rubik;
  }
  a{
  font-family: Rubik;
  }
  ul{
  font-family: Rubik;
  }
  ol{
  font-family: Rubik;
  }
  body{
  font-family: Rubik;
  font-size: 15px;
}
p{
  font-family: Rubik;
  font-size: 15px;
}
body { background-color: #FFFFFF; }

</style>

```{r include = FALSE}
#load the libraries via the below source as well as the credentials and set the theme
source("W:/Project/RACE COUNTS/2025_v7/RC_Github/AB/RaceCounts/Functions/draft_visual_functions.R")
options(highcharter.theme = hc_theme_smpl(tooltip = list(valueDecimals = 2)))

##Add RC theme##
rc_theme # load from the above draft_visual_functions.R script
issue <- 'Crime & Justice' # 7 options: Crime & Justice, Democracy, Economic Opportunity, Education, Healthy Built Environment, Health Care Access, Housing
rc_schema <- 'v7'
rc_yr <- '2025'
acs_yr <- '2023'

```

```{r echo=FALSE, include = FALSE}

####################### ADD COUNTY DATA #####################################

c_1 <- dbGetQuery(con, paste0("SELECT * FROM ", rc_schema, ".arei_crim_incarceration_county_", rc_yr)) %>% 
  select(-total_pop)
c_2 <- dbGetQuery(con, paste0("SELECT * FROM ", rc_schema, ".arei_crim_perception_of_safety_county_", rc_yr))
c_3 <- dbGetQuery(con, paste0("SELECT * FROM ", rc_schema, ".arei_crim_status_offenses_county_", rc_yr))
c_4 <- dbGetQuery(con, paste0("SELECT * FROM ", rc_schema, ".arei_crim_use_of_force_county_", rc_yr)) %>% 
  select(-total_pop)
c_5 <- dbGetQuery(con, paste0("SELECT * FROM ", rc_schema, ".arei_crim_officer_initiated_stops_county_", rc_yr)) %>% 
  select(-total_pop) ##Added new indicator - Officer-initiated stops

c_index_z <- dbGetQuery(con, paste0("SELECT * FROM ", rc_schema, ".arei_crim_index_", rc_yr))


####################### POPULATION DATA #####################################
#Join total population to index view, indicator data frames
pop <- dbGetQuery(con2, paste0("SELECT geoid, dp05_0001e FROM demographics.acs_5yr_dp05_multigeo_", acs_yr)) %>% rename(total_pop = dp05_0001e)

c_index_z <- left_join(x = c_index_z, y = pop, by = c("county_id" = "geoid"))

c_1 <- left_join(x = c_1, y = pop, by = c("county_id" = "geoid"))
c_2 <- left_join(x = c_2, y = pop, by = c("county_id" = "geoid"))
c_3 <- left_join(x = c_3, y = pop, by = c("county_id" = "geoid"))
c_4 <- left_join(x = c_4, y = pop, by = c("county_id" = "geoid"))
c_5 <- left_join(x = c_5, y = pop, by = c("county_id" = "geoid")) ##Added for Officer_initiated_stops

####################### ADD STATE DATA #####################################
s_1 <- dbGetQuery(con, paste0("SELECT * FROM ", rc_schema, ".arei_crim_incarceration_state_", rc_yr))
s_2 <- dbGetQuery(con, paste0("SELECT * FROM ", rc_schema, ".arei_crim_perception_of_safety_state_", rc_yr))
s_3 <- dbGetQuery(con, paste0("SELECT * FROM ", rc_schema, ".arei_crim_status_offenses_state_", rc_yr))
s_4 <- dbGetQuery(con, paste0("SELECT * FROM ", rc_schema, ".arei_crim_use_of_force_state_", rc_yr))
s_5 <- dbGetQuery(con, paste0("SELECT * FROM ", rc_schema, ".arei_crim_officer_initiated_stops_state_", rc_yr)) ##Added for Officer_initiated_stops

# merge with urban type
region_urban_type <- dbGetQuery(con, paste0("SELECT geoid AS county_id, region, urban_type FROM ", rc_schema, ".arei_multigeo_list"))

c_1 <- left_join(c_1, region_urban_type)
c_2 <- left_join(c_2, region_urban_type)
c_3 <- left_join(c_3, region_urban_type)
c_4 <- left_join(c_4, region_urban_type)
c_5 <- left_join(c_5, region_urban_type)

##Add 2025 v7 Source Data##
v7_sources <- dbGetQuery(con, paste0("SELECT * FROM ", rc_schema, ".arei_indicator_list_cntyst"))
v7_sources <- v7_sources %>% filter(v7_sources$arei_issue_area==issue)

```

<!-- *** -->
# Introduction
NOTE: The data and findings below are drafts subject to change and some pieces are still in the QA process.

RACE COUNTS provides a 3D view of racial equity:
<br>PERFORMANCE: How well people are doing. The higher the circle, the better the performance.
<br>DISPARITY: How racial groups compare to one another. The further right the circle, the greater the differences by race.
<br>IMPACT: The total population. The bigger the circle, the larger the population.

<br><span style="color:purple">Purple</span> counties: Gains at Risk; 
<br><span style="color:orange">Orange</span> counties: Prosperity for the Few;
<br><span style="color:#c9cc14">Yellow</span> counties: Struggling to Prosper;
<br><span style="color:red">Red</span> counties: Stuck and Unequal.

# Key Findings

* Black Californians are significantly more likely to experience Law Enforcement Use of Force, with a rate 30.5x higher compared to other groups.

* Black Youth experience the greatest racial disparity in arrests for Status Offenses, being 2.6 times more likely to be arrested for these offenses compared to White Youth. 

* The majority of Californians (over 80%) generally feel safe in their neighborhoods. However, White, SWANA, and Those of Two or More Races (Non-Latinx) report feeling safer than the state average.

# Race/Ethnicity Notes
<br>1) "Other" race includes those who identify with a race outside of the specifically named categories, such as Asian, White, etc.
<br>2) Race labels for bar charts: The "nh_" prefix signifies that a group is non-Latinx (excludes Latinx).
<br>3) The "twoormor" group represents those who identify as Two or More Races.

# Indicators

## Crime and Justice Index - UPDATED
```{r, echo=FALSE}
# Remove counties without quadrant values. Cap index perf/disp z-scores at 2 and -2. More info: https://advancementproject.sharepoint.com/:w:/s/Portal/EX59kBOn8iRNrLuY1Sfk3JABT34dO3sj1j9fwkuUxLqUgQ?e=bGyEaZ
  c_index_z <- c_index_z %>% mutate(arei_issue_area=v7_sources$arei_issue_area[1])
  c_index_chart <- index_scatterplot(c_index_z, 2)

  c_index_chart

```

* Four out of six Southern California counties are in the Purple Quadrant (Higher Performance, Lower Disparity). San Bernardino County experiences lower performance and lower racial disparity rates, while Los Angeles County experiences lower performance and higher racial disparity rates.


## Incarceration - NOT UPDATED {.tabset .tabset-fade}

### Scatterplot

```{r, echo=FALSE}
c_1 <- c_1 %>% mutate(arei_indicator=v7_sources$arei_indicator[5], bar_chart_header=v7_sources$bar_chart_header[5], description = v7_sources$methodology[5])
c_1_chart <- county_scatterplot(c_1)
c_1_chart


```
* Los Angeles ranks among the counties with the most racial disparity (rank of 3) but has higher performance - meaning a lower overall incarceration rate - (rank of 10).
* Sutter is the only county in the Red Quadrant (Higher Disparity, Lower Performance). Black Californians are 153 times more likely to be incarcerated as the group with the lowest rate, leading to Sutter being the second most disparate county in the state on this measure.
* In Yolo County, with the worst racial disparities for incarceration, Black residents are 355 times more likely to be incarcerated as the group with the lowest rate.


### State Barchart
```{r, echo=FALSE}

  title = v7_sources$bar_chart_header[5]
  s_1_ <- state_barchart(s_1, title)
  s_1_

```  
* Black Californians are 19.5 times more likely to be incarcerated than the group with the lowest incarceration rate statewide. They are 1.8 times more likely to be incarcerated than even the group with the next highest rate (non-Latinx AIAN) indicating the extreme racial disparity facing this group.

### County Barchart

```{r, echo=FALSE}
c_1_long <- county_barchart(c_1, title) 
c_1_long
```


## Perception of Safety - UPDATED {.tabset .tabset-fade}

### Scatterplot

```{r, echo=FALSE}
c_2 <- c_2 %>% mutate(arei_indicator=v7_sources$arei_indicator[1], bar_chart_header=v7_sources$bar_chart_header[1], description = v7_sources$methodology[1])
c_2_chart <- county_scatterplot(c_2)
c_2_chart


```
* El Dorado County is the most racially disparate on this measure, with 56.1% of its Black residents having a much lower perception of safety than other groups within the county.

* Placer County has the highest perception of safety, but its NHPI residents report a much lower perception of safety compared to other groups within the county.


### State Barchart
```{r, echo=FALSE}
  title = v7_sources$bar_chart_header[1]
  s_2_ <- state_barchart(s_2, title)
  s_2_

```
* More than 4 out of 5 Californians reported feeling safe in their neighborhood all or most of the time.

* Non-Hispanic Whites, those of Two or More Races (non-Latinx), and SWANA residents are the only groups who report feeling safer than the state average. 

### County Barchart

```{r, echo=FALSE}
c_2_long <- county_barchart(c_2, title) 
c_2_long
```


## Arrests for Status Offenses - UPDATED {.tabset .tabset-fade}

### Scatterplot

```{r, echo=FALSE}
c_3 <- c_3 %>% mutate(arei_indicator=v7_sources$arei_indicator[2], bar_chart_header=v7_sources$bar_chart_header[2], description = v7_sources$methodology[2])
c_3_chart <- county_scatterplot(c_3)
c_3_chart
```
* Nevada County is ranked the most disparate and among the lowest performing counties in the state for Youth Status Offense Arrests. 


### State Barchart

```{r, echo=FALSE}
  title = v7_sources$bar_chart_header[2]
  s_3_ <- state_barchart(s_3, title)
  s_3_

``` 
* Black Youth face by far the most racial disparity on this measure. They are 2.6 times more likely to be arrested for status offenses than White Youth. 


### County Barchart

```{r, echo=FALSE}
c_3_long <- county_barchart(c_3, title) 
c_3_long

```


## Use of Force - UPDATED {.tabset .tabset-fade}

### Scatterplot

```{r, echo=FALSE}
c_4 <- c_4 %>% mutate(arei_indicator=v7_sources$arei_indicator[4], bar_chart_header=v7_sources$bar_chart_header[4], description = v7_sources$methodology[4])
c_4_chart <- county_scatterplot(c_4)
c_4_chart

```
* 9 out the 12 counties in the Red Quadrant (Higher Disparity, Lower Performance) are in the Northern/Sierra region. Note that we do expect to see somewhat more extreme higher and lower estimates in counties, like these, with smaller populations.



### State Barchart

```{r, echo=FALSE}

  title = v7_sources$bar_chart_header[4]
  s_4_ <- state_barchart(s_4, title)
  s_4_

```
* Black Californians are 30.5 times more likely, and Pacific Islander Californians 27 times more likely, to be subject to Law Enforcement Use of Force than the group with the lowest rate. 

### County Barchart

```{r, echo=FALSE}
c_4_long <- county_barchart(c_4, title) 
c_4_long
```

## Officer-Initiated Stops - UPDATED {.tabset .tabset-fade}

### Scatterplot


```{r, echo=FALSE}
c_5 <- c_5 %>% mutate(arei_indicator=v7_sources$arei_indicator[3], bar_chart_header=v7_sources$bar_chart_header[3], description = v7_sources$methodology[3])
c_5_chart <- county_scatterplot(c_5)
c_5_chart
```
* Most counties are near average when it comes to performance for this measure.

* Alpine County is the most racially disparate for this measure and is also among the lowest performing because of its high rates of Officer-Initiated Stops for its Latinx and White residents.



### State Barchart

```{r, echo=FALSE}
  title = v7_sources$bar_chart_header[3]
  s_5_ <- state_barchart(s_5, title)
  s_5_


```
 * Pacific Islanders experience officer-initiated stops 2.3 times more than the state average and 6.1 times more than the group with the lowest rate. 
 

### County Barchart
```{r, echo=FALSE}
c_5_long <- county_barchart(c_5, title) 
c_5_long
```

```{r, echo=FALSE}
##Disconnect from db
dbDisconnect(con)
dbDisconnect(con2)


``` 

```{r echo=FALSE, include = FALSE}
# below is a javascript chunk for the county bar-charts. The chunk automatically selects the 'Alameda' county as the first chunk. Without the chunk below, as you can see from the output above, the first bar-chart shown sums the race/ethnicity rates for all of the counties. 
# Each line that starts with document is for each graph (0-5) for a total of 6 graphs. If another graph is added, then you would simply add another line and label it as [6]. 

# Notice that it isn't an R chunk, it is a JS chunk. :) 
```


```{js}
function filter_default() {
    document.getElementsByClassName("selectized") 
[0].selectize.setValue("Alameda", false);

 document.getElementsByClassName("selectized") 
[1].selectize.setValue("Alameda", false);

 document.getElementsByClassName("selectized") 
[2].selectize.setValue("Alameda", false);

 document.getElementsByClassName("selectized") 
[3].selectize.setValue("Alameda", false);

 }
window.onload = filter_default;
```





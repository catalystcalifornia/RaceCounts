---
title: "RACE COUNTS: Economic Opportunity"
author: "Authored by: Catalyst California"
date: "8/25/2025"
output:
  html_document:
    number_sections: no
    theme: flatly
    toc: yes
    toc_depth: 3
    toc_float: yes

subtitle: 'Draft Visuals'
---
  
<style type="text/css">
  h1{
  font-family: Rubik;
  }
  h2{
  font-family: Rubik;
  }
  h3{
  font-family: Rubik;
  }
  a{
  font-family: Rubik;
  }
  ul{
  font-family: Rubik;
  }
  ol{
  font-family: Rubik;
  }
  body{
  font-family: Rubik;
  font-size: 15px;
}
p{
  font-family: Rubik;
  font-size: 15px;
}
body { background-color: #FFFFFF; }

</style>

```{r include = FALSE}
knitr::opts_chunk$set(comment = FALSE, message = FALSE, warning = FALSE, echo = FALSE)

#load the libraries via the below source as well as the credentials and set the theme
source("W:/Project/RACE COUNTS/2025_v7/RC_Github/AB/RaceCounts/Functions/draft_visual_functions.R")



options(highcharter.theme = hc_theme_smpl(tooltip = list(valueDecimals = 2)))

##Add RC theme##
rc_theme # load from the above draft_visual_functions.R script
issue <- 'Economic Opportunity' # 7 options: Crime & Justice, Democracy, Economic Opportunity, Education, Healthy Built Environment, Health Care Access, Housing
rc_schema <- 'v7'
rc_yr <- '2025'
acs_yr <- '2023'


####################### ADDED v7 COUNTY DATA #####################################

c_1 <- dbGetQuery(con, paste0("SELECT * FROM ", rc_schema, ".arei_econ_living_wage_county_", rc_yr))  %>% rename(total_pop=pop_total)
c_2 <- dbGetQuery(con, paste0("SELECT * FROM ", rc_schema, ".arei_econ_employment_county_", rc_yr))
c_3 <- dbGetQuery(con, paste0("SELECT * FROM ", rc_schema, ".arei_econ_internet_county_", rc_yr))
c_4 <- dbGetQuery(con, paste0("SELECT * FROM ", rc_schema, ".arei_econ_per_capita_income_county_", rc_yr))
c_5 <- dbGetQuery(con, paste0("SELECT * FROM ", rc_schema, ".arei_econ_officials_county_", rc_yr)) %>% rename(total_pop=pop_total)
c_6 <- dbGetQuery(con, paste0("SELECT * FROM ", rc_schema, ".arei_econ_real_cost_measure_county_", rc_yr))
c_7 <- dbGetQuery(con, paste0("SELECT * FROM ", rc_schema, ".arei_econ_connected_youth_county_", rc_yr))%>% rename(total_pop=pop_total)

c_index_z <- dbGetQuery(con, paste0("SELECT * FROM ", rc_schema, ".arei_econ_index_", rc_yr))


####################### POPULATION DATA #####################################
#Join total population 
pop <- dbGetQuery(con2, paste0("SELECT geoid, dp05_0001e FROM demographics.acs_5yr_dp05_multigeo_", acs_yr)) %>% rename(total_pop = dp05_0001e)

c_index_z <- left_join(x = c_index_z, y = pop, by = c("county_id" = "geoid"))

c_4 <- left_join(x = c_4, y = pop, by = c("county_id" = "geoid"))


####################### ADD STATE DATA #####################################
s_1 <- dbGetQuery(con, paste0("SELECT * FROM ", rc_schema, ".arei_econ_living_wage_state_", rc_yr))  
s_2 <- dbGetQuery(con, paste0("SELECT * FROM ", rc_schema, ".arei_econ_employment_state_", rc_yr))
s_3 <- dbGetQuery(con, paste0("SELECT * FROM ", rc_schema, ".arei_econ_internet_state_", rc_yr))
s_4 <- dbGetQuery(con, paste0("SELECT * FROM ", rc_schema, ".arei_econ_per_capita_income_state_", rc_yr))
s_5 <- dbGetQuery(con, paste0("SELECT * FROM ", rc_schema, ".arei_econ_officials_state_", rc_yr))
s_6 <- dbGetQuery(con, paste0("SELECT * FROM ", rc_schema, ".arei_econ_real_cost_measure_state_", rc_yr))
s_7 <- dbGetQuery(con, paste0("SELECT * FROM ", rc_schema, ".arei_econ_connected_youth_state_", rc_yr))

# # merge with urban type 
# region_urban_type <- dbGetQuery(con, paste0("SELECT geoid AS county_id, region, urban_type FROM ", rc_schema, ".arei_multigeo_list")) 
# 
# c_1 <- left_join(c_1, region_urban_type)
# c_2 <- left_join(c_2, region_urban_type)
# c_3 <- left_join(c_3, region_urban_type)
# c_4 <- left_join(c_4, region_urban_type)
# c_5 <- left_join(c_5, region_urban_type)
# c_6 <- left_join(c_6, region_urban_type)
# c_7 <- left_join(c_7, region_urban_type)

##Add 2024 v7 Source Data##
v7_sources <- dbGetQuery(con, paste0("SELECT * FROM ", rc_schema, ".arei_indicator_list_cntyst"))
v7_sources <- v7_sources %>% filter(v7_sources$arei_issue_area==issue)
```

<!-- *** -->
# Introduction
NOTE: The data and findings below are drafts subject to change and some pieces are still in the QA process.

RACE COUNTS provides a 3D view of racial equity:
<br>PERFORMANCE: How well people are doing. The higher the circle, the better the performance.
<br>DISPARITY: How racial groups compare to one another. The further right the circle, the greater the differences by race.
<br>IMPACT: The total population. The bigger the circle, the larger the population.

<br><span style="color:purple">Purple</span> counties: Gains at Risk; 
<br><span style="color:orange">Orange</span> counties: Prosperity for the Few;
<br><span style="color:#c9cc14">Yellow</span> counties: Struggling to Prosper;
<br><span style="color:red">Red</span> counties: Stuck and Unequal.

# Key Findings 

* Central Valley counties exhibit lower economic performance and greater racial disparity in economic opportunity and wages compared to other counties. (See scatterplot on Economic Opportunity Index and People Ages 18-64 Earning A Living Wage (%))


* NH-White and Asian residents across the counties have higher per capita income compared to other racial groups, who earn below the average income rate for all groups. (See bar chart on Per Capita Income ($))

* NH-AIAN, NH-Black, and Latinx residents have incomes that fall below the cost-of-living-adjusted poverty rate. (See bar chart on Households Above Real Cost Measure ($))

* Pacific Islanders, Latinx, AIAN, and NH-Black residents are far less likely to be employed as officials or managers. (See bar chart on People Ages 18-64 in labor Force who are Employed as Officials or Managers per 1k People)


# Race/Ethnicity Notes
<br>1) "Other" race includes those who identify with a race outside of the specifically named categories, such as Asian, White, etc.
<br>2) Race labels for bar charts: The "NH_" prefix signifies that a group is non-Latinx (excludes Latinx).
<br>3) The "two_or_more" group represents those who identify as Two or More Races.

# Indicators

## Economic Opportunity Index {.tabset .tabset-fade}
```{r, echo=FALSE}
# Remove counties without quadrant values. Cap index perf/disp z-scores at 2 and -2. More info: https://advancementproject.sharepoint.com/:w:/s/Portal/EX59kBOn8iRNrLuY1Sfk3JABT34dO3sj1j9fwkuUxLqUgQ?e=bGyEaZ
  c_index_z <- c_index_z %>% mutate(arei_issue_area=v7_sources$arei_issue_area[1])
  c_index_chart <- index_scatterplot(c_index_z, 2)

  c_index_chart
```

* Most Central Valley counties have lower than average performance, with most having higher than average disparity as well. 

* All Bay Area counties have higher than average performance with low levels of disparity on the Economic Opportunity Index. However, Marin, Napa, and San Francisco also have higher than average levels of disparity.

## Living Wage {.tabset .tabset-fade}


### Scatterplot

```{r, echo=FALSE} 

c_1 <- c_1 %>% mutate(arei_indicator=v7_sources$arei_indicator[5], bar_chart_header=v7_sources$bar_chart_header[5], description = v7_sources$methodology[5])
c_1_chart <- county_scatterplot(c_1)
c_1_chart

```
* 
* 
* 

### State Barchart
```{r, echo=FALSE}

  title = v7_sources$bar_chart_header[5]
  s_1_ <- state_barchart(s_1, title)
  s_1_

``` 
* 
* 

### County Barchart

```{r, echo=FALSE}
c_1_long <- county_barchart(c_1, title) 
c_1_long
```


## Employment Status  {.tabset .tabset-fade}

### Scatterplot

```{r, echo=FALSE} 

c_2 <- c_2 %>% mutate(arei_indicator=v7_sources$arei_indicator[2], bar_chart_header=v7_sources$bar_chart_header[2], description = v7_sources$methodology[2])
c_2_chart <- county_scatterplot(c_2)
c_2_chart

```
* 
* 
* 

### State Barchart
```{r, echo=FALSE}

  title = v7_sources$bar_chart_header[2]
  s_2_ <- state_barchart(s_2, title)
  s_2_

``` 
* 
* 

### County Barchart

```{r, echo=FALSE}
c_2_long <- county_barchart(c_2, title) 
c_2_long
```


## Internet Access {.tabset .tabset-fade}


### Scatterplot

```{r, echo=FALSE} 

c_3 <- c_3 %>% mutate(arei_indicator=v7_sources$arei_indicator[6], bar_chart_header=v7_sources$bar_chart_header[6], description = v7_sources$methodology[6])
c_3_chart <- county_scatterplot(c_3)
c_3_chart

```
* 
* 
* 

### State Barchart
```{r, echo=FALSE}

  title = v7_sources$bar_chart_header[6]
  s_3_ <- state_barchart(s_3, title)
  s_3_

``` 
* 
* 

### County Barchart

```{r, echo=FALSE}
c_3_long <- county_barchart(c_3, title) 
c_3_long
```


## Per Capita Income {.tabset .tabset-fade}


### Scatterplot

```{r, echo=FALSE} 

c_4 <- c_4 %>% mutate(arei_indicator=v7_sources$arei_indicator[1], bar_chart_header=v7_sources$bar_chart_header[1], description = v7_sources$methodology[1])
c_4_chart <- county_scatterplot(c_4)
c_4_chart

```
* 
* 
* 

### State Barchart
```{r, echo=FALSE}

  title = v7_sources$bar_chart_header[1]
  s_4_ <- state_barchart(s_4, title)
  s_4_

``` 
* 
* 

### County Barchart

```{r, echo=FALSE}
c_4_long <- county_barchart(c_4, title) 
c_4_long
```


## Officials & Managers {.tabset .tabset-fade}

### Scatterplot

```{r, echo=FALSE} 

c_5 <- c_5 %>% mutate(arei_indicator=v7_sources$arei_indicator[4], bar_chart_header=v7_sources$bar_chart_header[4], description = v7_sources$methodology[4])
c_5_chart <- county_scatterplot(c_5)
c_5_chart

```
* 
* 
* 

### State Barchart
```{r, echo=FALSE}

  title = v7_sources$bar_chart_header[4]
  s_5_ <- state_barchart(s_5, title)
  s_5_

``` 
* 
* 

### County Barchart

```{r, echo=FALSE}
c_5_long <- county_barchart(c_5, title) 
c_5_long
```



## Real Cost Measure {.tabset .tabset-fade}

### Scatterplot

```{r, echo=FALSE} 

c_6 <- c_6 %>% mutate(arei_indicator=v7_sources$arei_indicator[7], bar_chart_header=v7_sources$bar_chart_header[7], description = v7_sources$methodology[7])
c_6_chart <- county_scatterplot(c_6)
c_6_chart

```
* 
* 
* 

### State Barchart
```{r, echo=FALSE}

  title = v7_sources$bar_chart_header[7]
  s_6_ <- state_barchart(s_6, title)
  s_6_

``` 
* 
* 

### County Barchart

```{r, echo=FALSE}
c_6_long <- county_barchart(c_6, title) 
c_6_long
```



## Connected Youth {.tabset .tabset-fade}

### Scatterplot

```{r, echo=FALSE} 

c_7 <- c_7 %>% mutate(arei_indicator=v7_sources$arei_indicator[3], bar_chart_header=v7_sources$bar_chart_header[3], description = v7_sources$methodology[3])
c_7_chart <- county_scatterplot(c_7)
c_7_chart

```
* 
* 
* 

### State Barchart
```{r, echo=FALSE}

  title = v7_sources$bar_chart_header[3]
  s_7_ <- state_barchart(s_7, title)
  s_7_

``` 
* 
* 

### County Barchart

```{r, echo=FALSE}
c_7_long <- county_barchart(c_7, title) 
c_7_long
```


```{r, echo=FALSE}
##Disconnect from database
dbDisconnect(con)
dbDisconnect(con2)

```

```{r echo=FALSE, include = FALSE}
# below is a javascript chunk for the county bar-charts. The chunk automatically selects the 'Alameda' county as the first chunk. Without the chunk below, as you can see from the output above, the first bar-chart shown sums the race/ethnicity rates for all of the counties. 
# Each line that starts with document is for each graph (0-5) for a total of 6 graphs. If another graph is added, then you would simply add another line and label it as [6]. 

# Notice that it isn't an R chunk, it is a JS chunk. :) 
```
Warning: Specifying width/height in layout() is now deprecated.
Please specify in ggplotly() or plot_ly()Warning: Sum of bscol width units is greater than 12Warning: Ignoring 241 observationsWarning: Ignoring 241 observations> 

```{js}
function filter_default() {
    document.getElementsByClassName("selectized") 
[0].selectize.setValue("Alameda", false);

 document.getElementsByClassName("selectized") 
[1].selectize.setValue("Alameda", false);

 document.getElementsByClassName("selectized") 
[2].selectize.setValue("Alameda", false);

 document.getElementsByClassName("selectized") 
[3].selectize.setValue("Alameda", false);

 document.getElementsByClassName("selectized") 
[4].selectize.setValue("Alameda", false);

 document.getElementsByClassName("selectized") 
[5].selectize.setValue("Alameda", false);

 document.getElementsByClassName("selectized") 
[6].selectize.setValue("Alameda", false);
 }
window.onload = filter_default;
```




